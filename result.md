# 神经网络多频因子结果

本文主要研究了三种模型来预测股票的T+10收益率，三种模型如下：

* 基于 GRU 的15分钟频数据模型（分钟模型）

* 日频+15分钟频数据混合模型（混合模型）

* 基于参数冻结+残差预测的增量学习模型（冻结模型）

超参数如下，基本和华泰证券研报保持一致：

```python
input_size1 = 6
input_size2 = 6
hidden_size = 30
output_size = 1
learning_rate = 0.0001
num_epochs = 50
batch_size = 1024
```

其中`input_size1`和`input_size2`分别表示15分钟频数据的特征长度和日频数据的特征长度。接下来分别展示三种模型的结果。

## 1. 基于GRU的15分钟频数据模型

模型从2017年开始每半年进行一次滚动训练，所有滚动训练的结果如下：

| Date       | Best Train Loss | Best Test Loss |
| ---------- | --------------- | -------------- |
| 2016-12-32 | -0.12359        | -0.07586       |
| 2017-06-31 | -0.11164        | -0.06527       |
| 2017-12-32 | -0.10669        | -0.09989       |
| 2018-06-31 | -0.10676        | -0.09524       |
| 2018-12-32 | -0.12151        | -0.13839       |
| 2019-06-31 | -0.12731        | -0.13036       |
| 2019-12-32 | -0.12874        | -0.11622       |
| 2020-06-31 | -0.12841        | -0.08776       |
| 2020-12-32 | -0.12885        | -0.08138       |
| 2021-06-31 | -0.12310        | -0.07100       |
| 2021-12-32 | -0.12314        | -0.07118       |
| 2022-06-31 | -0.12364        | -0.07760       |
| 2022-12-32 | -0.11346        | -0.08541       |
| 2023-06-31 | -0.11491        | -0.08761       |

每次滚动训练完成之后都会对接下来的半年进行回测，回测的结果如下图：

<img title="" src="file:///C:/Users/zhouling_intern3/Documents/gru_backup/pic/result_min_2017_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png" alt="" data-align="inline">

在滚动回测每半年的数据结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | postive_ic |
| ---------- | ------- | ------- | ------- | ------- | ---------- |
| 2017-06-31 | 0.05377 | 0.10854 | 0.05600 | 0.49541 | 0.64706    |
| 2017-12-32 | 0.05350 | 0.08520 | 0.05656 | 0.62789 | 0.73600    |
| 2018-06-31 | 0.10498 | 0.05803 | 0.09994 | 1.80907 | 0.97479    |
| 2018-12-32 | 0.11355 | 0.06688 | 0.10239 | 1.69781 | 0.97581    |
| 2019-06-31 | 0.13506 | 0.08907 | 0.16487 | 1.51634 | 0.90678    |
| 2019-12-32 | 0.08001 | 0.07079 | 0.09927 | 1.13019 | 0.88095    |
| 2020-06-31 | 0.07231 | 0.09182 | 0.09481 | 0.78748 | 0.81197    |
| 2020-12-32 | 0.06848 | 0.08505 | 0.09781 | 0.80515 | 0.78571    |
| 2021-06-31 | 0.06235 | 0.07307 | 0.07560 | 0.85338 | 0.80508    |
| 2021-12-32 | 0.05331 | 0.05886 | 0.08700 | 0.90567 | 0.81600    |
| 2022-06-31 | 0.09769 | 0.08204 | 0.10928 | 1.19078 | 0.86325    |
| 2022-12-32 | 0.09099 | 0.07841 | 0.10628 | 1.16039 | 0.86400    |
| 2023-06-31 | 0.06411 | 0.08668 | 0.08104 | 0.73960 | 0.73729    |

## 2. 日频+15分钟频数据混合模型（混合模型）

模型从2017年开始每半年进行一次滚动训练，所有滚动训练的结果如下：

| Date       | Best Train Loss | Best Test Loss |
| ---------- | --------------- | -------------- |
| 2016-12-31 | -0.12247        | -0.10777       |
| 2017-06-30 | -0.11651        | -0.07253       |
| 2017-12-31 | -0.10917        | -0.09106       |
| 2018-06-30 | -0.12694        | -0.11474       |
| 2018-12-31 | -0.13855        | -0.13729       |
| 2019-06-30 | -0.13335        | -0.12233       |
| 2019-12-31 | -0.14556        | -0.10336       |
| 2020-06-30 | -0.14305        | -0.08761       |
| 2020-12-31 | -0.13189        | -0.08196       |
| 2021-06-30 | -0.13375        | -0.08437       |
| 2021-12-31 | -0.12331        | -0.07968       |
| 2022-06-30 | -0.12416        | -0.07966       |
| 2022-12-31 | -0.12033        | -0.08728       |
| 2023-06-30 | -0.11648        | -0.08508       |

每次滚动训练完成之后都会对接下来的半年进行回测，回测的结果如下图：

![](C:\Users\zhouling_intern3\Documents\gru_backup\pic\result_day_2017_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png)

在滚动回测每半年的数据结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | postive_ic |
| ---------- | ------- | ------- | ------- | ------- |:---------- |
| 2017-06-30 | 0.05973 | 0.07549 | 0.06072 | 0.79124 | 0.76471    |
| 2017-12-31 | 0.06499 | 0.10351 | 0.06025 | 0.62787 | 0.78400    |
| 2018-06-30 | 0.09799 | 0.05181 | 0.09238 | 1.89148 | 0.98319    |
| 2018-12-31 | 0.11164 | 0.07031 | 0.11279 | 1.58776 | 0.96774    |
| 2019-06-30 | 0.13420 | 0.09789 | 0.15526 | 1.37090 | 0.92373    |
| 2019-12-31 | 0.07208 | 0.07547 | 0.09563 | 0.95502 | 0.78571    |
| 2020-06-30 | 0.08155 | 0.08972 | 0.09583 | 0.90891 | 0.81197    |
| 2020-12-31 | 0.08041 | 0.09540 | 0.11009 | 0.84285 | 0.83333    |
| 2021-06-30 | 0.06831 | 0.07820 | 0.08061 | 0.87352 | 0.78814    |
| 2021-12-31 | 0.05793 | 0.06425 | 0.08950 | 0.90170 | 0.76000    |
| 2022-06-30 | 0.10721 | 0.09695 | 0.12396 | 1.10582 | 0.87179    |
| 2022-12-31 | 0.08940 | 0.07903 | 0.10061 | 1.13122 | 0.83200    |
| 2023-06-30 | 0.06890 | 0.08998 | 0.08076 | 0.76571 | 0.72034    |

## 3. 基于参数冻结+残差预测的增量学习模型（冻结模型）

模型从2017年开始每半年进行一次滚动训练，所有滚动训练的结果如下：

| Date       | day model Train Loss | day model Valid Loss | hybrid model Train Loss | hybrid model Valid Loss |
| ---------- | -------------------- | -------------------- | ----------------------- | ----------------------- |
| 2016-12-31 | -0.04434             | -0.00656             | -0.13552                | -0.08341                |
| 2017-06-30 | -0.03511             | -0.00781             | -0.12494                | -0.06059                |
| 2017-12-31 | -0.04208             | -0.00422             | -0.12899                | -0.08936                |
| 2018-06-30 | -0.03854             | 0.00068              | -0.15163                | -0.10929                |
| 2018-12-31 | -0.03622             | -0.00580             | -0.14670                | -0.13346                |
| 2019-06-30 | -0.04572             | -0.00354             | -0.15418                | -0.11105                |
| 2019-12-31 | -0.03778             | -0.00206             | -0.15024                | -0.10125                |
| 2020-06-30 | -0.03526             | -0.00432             | -0.15144                | -0.08225                |
| 2020-12-31 | -0.04582             | -0.00546             | -0.14895                | -0.07784                |
| 2021-06-30 | -0.04789             | -0.00268             | -0.14522                | -0.06813                |
| 2021-12-31 | -0.03952             | -0.00332             | -0.13442                | -0.07234                |
| 2022-06-30 | -0.03952             | -0.00525             | -0.13617                | -0.07218                |
| 2022-12-31 | -0.04147             | -0.00330             | -0.13185                | -0.07897                |
| 2023-06-30 | -0.04113             | -0.00191             | -0.13041                | -0.07571                |

回测结果如下：
![](C:\Users\zhouling_intern3\Documents\gru_backup\pic\result_double_2017_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png)

在滚动回测每半年的数据结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | postive_ic |
| ---------- | ------- | ------- | ------- | ------- | ---------- |
| 2017-06-30 | 0.05236 | 0.07126 | 0.05892 | 0.73474 | 0.75630    |
| 2017-12-31 | 0.06966 | 0.09434 | 0.07073 | 0.73831 | 0.77600    |
| 2018-06-30 | 0.09335 | 0.06179 | 0.08772 | 1.51067 | 0.94118    |
| 2018-12-31 | 0.11428 | 0.07491 | 0.10978 | 1.52551 | 0.95968    |
| 2019-06-30 | 0.13319 | 0.09266 | 0.14982 | 1.43733 | 0.94915    |
| 2019-12-31 | 0.07200 | 0.08225 | 0.09175 | 0.87538 | 0.79365    |
| 2020-06-30 | 0.07326 | 0.08300 | 0.09344 | 0.88262 | 0.80342    |
| 2020-12-31 | 0.06634 | 0.10067 | 0.09817 | 0.65902 | 0.73016    |
| 2021-06-30 | 0.06454 | 0.07370 | 0.07670 | 0.87566 | 0.80508    |
| 2021-12-31 | 0.05349 | 0.05879 | 0.07785 | 0.90984 | 0.81600    |
| 2022-06-30 | 0.09479 | 0.08399 | 0.10117 | 1.12863 | 0.86325    |
| 2022-12-31 | 0.08357 | 0.07262 | 0.09172 | 1.15077 | 0.84000    |
| 2023-06-30 | 0.06087 | 0.08549 | 0.07668 | 0.71207 | 0.72881    |

## 4. 基于LSTM的模型

由于LSTM和GRU类似是一种常用的时间序列模型，因此在测试了GRU模型效果之后也测试了LSTM模型的效果，并且将结果展示如下。

首先展示15min模型的结果：

![lstm_min_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png](C:\Users\zhouling_intern3\Documents\gru_backup\pic\lstm_min_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png)

半年的滚动回测结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | positive_ic |
| ---------- | ------- | ------- | ------- | ------- | ----------- |
| 2017-06-31 | 0.06172 | 0.08780 | 0.06591 | 0.70299 | 0.76471     |
| 2017-12-32 | 0.05743 | 0.10506 | 0.06810 | 0.54668 | 0.72000     |
| 2018-06-31 | 0.09430 | 0.06295 | 0.08978 | 1.49812 | 0.94958     |
| 2018-12-32 | 0.10371 | 0.07222 | 0.07755 | 1.43597 | 0.92742     |
| 2019-06-31 | 0.12095 | 0.07310 | 0.13817 | 1.65450 | 0.93220     |
| 2019-12-32 | 0.06176 | 0.07822 | 0.09093 | 0.78962 | 0.77778     |
| 2020-06-31 | 0.07404 | 0.08497 | 0.09081 | 0.87128 | 0.83761     |
| 2020-12-32 | 0.06150 | 0.08334 | 0.09029 | 0.73799 | 0.75397     |
| 2021-06-31 | 0.05856 | 0.07556 | 0.07750 | 0.77501 | 0.77119     |
| 2021-12-32 | 0.04920 | 0.05841 | 0.06984 | 0.84244 | 0.81600     |
| 2022-06-31 | 0.10112 | 0.08441 | 0.12397 | 1.19802 | 0.88034     |
| 2022-12-32 | 0.08313 | 0.07020 | 0.09399 | 1.18407 | 0.86400     |
| 2023-06-31 | 0.05745 | 0.09541 | 0.06766 | 0.60218 | 0.68644     |

15min频加日频的模型回测结果如下：

![lstm_day_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png](C:\Users\zhouling_intern3\Documents\gru_backup\pic\lstm_day_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png)

半年滚动训练的测试结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | positive_ic |
| ---------- | ------- | ------- | ------- | ------- | ----------- |
| 2017-06-31 | 0.07153 | 0.07824 | 0.07129 | 0.91418 | 0.80672     |
| 2017-12-32 | 0.07631 | 0.10404 | 0.08164 | 0.73346 | 0.78400     |
| 2018-06-31 | 0.09767 | 0.05446 | 0.08965 | 1.79326 | 0.97479     |
| 2018-12-32 | 0.11280 | 0.08072 | 0.10452 | 1.39742 | 0.92742     |
| 2019-06-31 | 0.11867 | 0.07227 | 0.12912 | 1.64213 | 0.94915     |
| 2019-12-32 | 0.06565 | 0.07423 | 0.09103 | 0.88449 | 0.77778     |
| 2020-06-31 | 0.08954 | 0.07207 | 0.10533 | 1.24245 | 0.90598     |
| 2020-12-32 | 0.07317 | 0.08580 | 0.10344 | 0.85280 | 0.83333     |
| 2021-06-31 | 0.06295 | 0.07293 | 0.06883 | 0.86311 | 0.82203     |
| 2021-12-32 | 0.05609 | 0.06420 | 0.08650 | 0.87368 | 0.77600     |
| 2022-06-31 | 0.09526 | 0.08266 | 0.10097 | 1.15241 | 0.84615     |
| 2022-12-32 | 0.08203 | 0.07136 | 0.09020 | 1.14960 | 0.84800     |
| 2023-06-31 | 0.06741 | 0.08942 | 0.07564 | 0.75393 | 0.73729     |

基于参数冻结+残差预测的增量学习模型的回测结果如下：

![lstm_double_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png](C:\Users\zhouling_intern3\Documents\gru_backup\pic\lstm_double_000905.SH_bench_self_def_pool_pool_quantile_excess_return_2017-01-04_to_2023-06-30.png)

半年滚动训练的测试结果如下：

| Date       | IC Mean | IC Std  | Rank IC | IC_IR   | positive_ic |
| ---------- | ------- | ------- | ------- | ------- | ----------- |
| 2017-06-30 | 0.05032 | 0.06161 | 0.05092 | 0.81678 | 0.76471     |
| 2017-12-31 | 0.06614 | 0.08814 | 0.06623 | 0.75036 | 0.79200     |
| 2018-06-30 | 0.08260 | 0.05051 | 0.07853 | 1.63510 | 0.95798     |
| 2018-12-31 | 0.09502 | 0.06563 | 0.08509 | 1.44781 | 0.94355     |
| 2019-06-30 | 0.11190 | 0.06391 | 0.13051 | 1.75087 | 0.94915     |
| 2019-12-31 | 0.06320 | 0.08099 | 0.08258 | 0.78044 | 0.76984     |
| 2020-06-30 | 0.07307 | 0.06978 | 0.08572 | 1.04716 | 0.88034     |
| 2020-12-31 | 0.06983 | 0.07696 | 0.09096 | 0.90733 | 0.79365     |
| 2021-06-30 | 0.06085 | 0.07238 | 0.06908 | 0.84079 | 0.79661     |
| 2021-12-31 | 0.04132 | 0.05025 | 0.05961 | 0.82231 | 0.76800     |
| 2022-06-30 | 0.09171 | 0.08401 | 0.10148 | 1.09156 | 0.84615     |
| 2022-12-31 | 0.08109 | 0.07679 | 0.09569 | 1.05595 | 0.83200     |
| 2023-06-30 | 0.05425 | 0.08199 | 0.05802 | 0.66171 | 0.70339     |